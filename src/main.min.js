function Main(){}function AppInteractionService(e,t,i){this.toolBarHeight=e,this.currentFileId=null,this.currentCommentId=null,this.files=this.getFiles(),this.hotKeysService=t,this.main=i}function DecorationService(e){this.element=e}function HierarchyGeneratorService(){this.cnt=0}function HotKeysService(){this.diffNext=190,this.diffPrev=188,this.toggleSidebar=77,this.closeSidebar=27}Main.prototype.init=function(){this.hiddenSidebarUrls=[],this.pageLoadWaitTimeout=1e3,this.initialNumberOfFiles=0,this.hotKeysService=new HotKeysService,this.generateApp(),window==top&&(window.addEventListener("keyup",this.doKeyPress.bind(this),!1),setInterval(this.monitorUrlChange.bind(this),100)),setInterval(this.monitorLazyLoading.bind(this),100)},Main.prototype.generateApp=function(){this.currentPageUrl=this.getWindowLocationHref(),this.toolBarHeight=$(".pr-toolbar").height(),this.initialNumberOfFiles=$(".file").length;var e=[],t=[];$.each($(".file"),function(i,r){var n=$(r).find(".file-header[data-path]").data("path");n&&(e[i]=n,t[i]=r.id)});var i=$('<p id="jk-hierarchy"></p>');(new HierarchyGeneratorService).generateAndApplyHierarchyHtml(e,t,i),$("body").prepend(i);var r=new DecorationService(i);r.applyInitStyle(),r.reviewDiffs(),r.appendShowMore(),r.appendCommentCounts(),r.appendNoDiffMessage();var n=new AppInteractionService(this.toolBarHeight,this.hotKeysService,this);n.attachFolderCollapseBehavior(i),n.attachJumpOnClickBehavior(i),n.updateCurentDiffPos(),this.appInteractionService=n},Main.prototype.doKeyPress=function(e){var t=$(e.target).prop("tagName");"BODY"!=t&&void 0!=t||this.hotKeysService.isValidKeyCode(e.keyCode)&&this.appInteractionService.respondToHotKey(e.keyCode)},Main.prototype.monitorUrlChange=function(){this.isSameUrl()||(this.currentPageUrl=this.getWindowLocationHref(),$("#jk-hierarchy").remove())},Main.prototype.isSameUrl=function(){return this.currentPageUrl==this.getWindowLocationHref()},Main.prototype.getWindowLocationHref=function(){return window.location.href.split("#")[0]},Main.prototype.monitorLazyLoading=function(){this.initialNumberOfFiles!=$(".file").length&&($("#jk-hierarchy").remove(),this.generateApp())},$(document).ready(function(){$("body").on("click",".load-diff-button",function(){var e=$('<p id="jk-hierarchy"></p>'),t=new DecorationService(e),i=$(this).closest("div.file").attr("id");t.reviewDiffs(i)})}),AppInteractionService.prototype.attachFolderCollapseBehavior=function(e){$(e).find(".folder").click(function(){$header=$(this),$content=$header.next(),$content.slideToggle(10,function(){$header.toggleClass("collapsed")})})},AppInteractionService.prototype.attachJumpOnClickBehavior=function(e){var t=this;$(e).find(".jk-file").click(function(){t.scrollTo($("#"+$(this).data("file-id"))),$("#jk-hierarchy").find(".jk-file.current").removeClass("current"),$(this).addClass("current"),t.currentFileId=$(this).data("file-id").split("-")[1]})},AppInteractionService.prototype.scrollTo=function(e){if($(e).length){var t=$(e).offset().top-this.toolBarHeight-10;$("html,body").scrollTop(t),this.updateCurentDiffPos()}},AppInteractionService.prototype.updateCurentDiffPos=function(){if($("#jk-hierarchy").is(":visible")&&$("#jk-hierarchy").find(".jk-file.current").is(":visible")){for(;function(){var e=$("#jk-hierarchy").find(".jk-file.current").position();return e&&e.top<0}();)$("#jk-hierarchy").scrollTop($("#jk-hierarchy").scrollTop()-10);for(;function(){var e=$("#jk-hierarchy").find(".jk-file.current").position();return e&&e.top>$("#jk-hierarchy").height()}();)$("#jk-hierarchy").scrollTop($("#jk-hierarchy").scrollTop()+10)}},AppInteractionService.prototype.getFiles=function(){return $(".file")},AppInteractionService.prototype.getComments=function(){return $("#files .js-comment.unminimized-comment")},AppInteractionService.prototype.getCurrentEl=function(){return this.getFiles()[this.currentFileId]},AppInteractionService.prototype.updateCurrentPos=function(e){null==this.currentFileId?this.currentFileId=0:this.currentFileId<this.files.length-1&&e==this.hotKeysService.getKeyCodeForNextDiff()?this.currentFileId++:this.currentFileId>0&&e==this.hotKeysService.getKeyCodeForPrevDiff()&&this.currentFileId--},AppInteractionService.prototype.respondToHotKey=function(e){if(this.hotKeysService.isValidKeyCodeForDiff(e)){this.updateCurrentPos(e);var t=this.getCurrentEl();return void this.scrollTo(t)}this.hotKeysService.isValidKeyCodeForSideBarToggle(e)&&(this.isSidebarHaveContents()||($("#jk-hierarchy").remove(),this.main.generateApp()),this.isSidebarHaveContents()?$("#jk-hierarchy").toggle():$("#jk-notice").show().delay(600).fadeOut(600)),this.hotKeysService.isValidKeyCodeForCloseSidebar(e)&&this.isSidebarHaveContents()&&$("#jk-hierarchy").is(":visible")&&$("#jk-hierarchy").hide()},AppInteractionService.prototype.isSidebarHaveContents=function(){return $("#jk-hierarchy").length&&$("#jk-hierarchy")[0].innerHTML};var WARNING=0,DANGER=1,checklistKey="GITGUD_CHECKLIST";String.prototype.htmlSafe=function(){return this.valueOf().replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},DecorationService.prototype.applyInitStyle=function(){$(this.element).css("width",1.2*$(this.element).width()),$(this.element).css("background-color",$("body").css("background-color")),$(this.element).hide()},DecorationService.prototype.appendCommentCounts=function(){var e=$("#jk-hierarchy").find(".jk-file");$.each(e,function(e,t){var i=$(t).data("file-id"),r=$("#"+i).find(".js-comment.unminimized-comment");if(r.length){var n=$('<span class="comment-count"><b class="icon-comment">'+r.length+"</b></span>");$(t).append(n)}})},DecorationService.prototype.appendShowMore=function(){var e=$("#jk-hierarchy").find(".jk-file");$.each(e,function(e,t){var i=$(t).data("file-id"),r=$("#"+i).find(".load-diff-button");if(r.length>0){var r=$('<span class="unopened-count" title="Large diffs"><b class="icon-unopened">...</b></span>');$(t).append(r)}})},DecorationService.prototype.appendNoDiffMessage=function(){$("#jk-notice").length||($("body").prepend('<div id="jk-notice">No diffs found</div>'),$("#jk-notice").css("background-color",$("body").css("background-color")))},DecorationService.prototype.reviewDiffs=function(e){function t(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}function i(e,t){if("true"!==$(t).data("is-viewed")&&e.warningCounts>0){var i=$('<span class="gitgud-tooltip warning-count"><b class="icon-warning">'+e.warningCounts+'</b><span class="gitgud-tooltip-content"></span></span>');$(t).append(i),$.each(e.warnings,function(e,t){var r=$("<p>- "+t+"</p>");$(i).find(".gitgud-tooltip-content").append(r)})}}function r(e,t){if("true"!==$(t).data("is-viewed")&&e.dangerCounts>0){var i=$('<span class="gitgud-tooltip danger-count"><b class="icon-danger">'+e.dangerCounts+'</b><span class="gitgud-tooltip-content"></span></span>');$(t).append(i),$.each(e.dangers,function(e,t){var r=$("<p>- "+t+"</p>");$(i).find(".gitgud-tooltip-content").append(r)})}}function n(e,t){if(e>0){var e=$('<span class="warning-count"><b class="icon-warning">'+e+"</b></span>");$(t).append(e),$(t).addClass("gitgud-warning")}}function o(e,t){if(e>0){var e=$('<span class="danger-count"><b class="icon-danger">'+e+"</b></span>");$(t).append(e),$(t).addClass("gitgud-danger")}}function a(e,t,n){i(e,t),r(e,t),!0!==n&&$(t).data("is-viewed","true")}function s(e,i,r){chrome.storage.local.get(checklistKey,function(r){var s=0,c=0;PRChecklist=JSON.parse(r[checklistKey]),$.each(i,function(e,i){var r=$(i).find(".blob-code-inner.blob-code-marker").html(),n=t(r),o={warnings:[],dangers:[],warningCounts:0,dangerCounts:0};$.each(PRChecklist,function(e,t){n.includes(t.pattern)&&(t.type==WARNING?(o.warningCounts++,t.note.length&&o.warnings.push(t.note.htmlSafe())):(o.dangerCounts++,t.note.length&&o.dangers.push(t.note.htmlSafe())))}),a(o,i),s+=o.warningCounts,c+=o.dangerCounts}),n(s,e),o(c,e)})}if(e)var c=$("#"+e).find(".blob-code.blob-code-addition"),d=setInterval(function(){if(c.length){var t=$("#jk-hierarchy ").find("[data-file-id="+e+"]");$(t).find(".unopened-count").hide(),s(t,c,!0),clearInterval(d)}else c=$("#"+e).find(".blob-code.blob-code-addition")},1e3);else{var p=$("#jk-hierarchy").find(".jk-file");$.each(p,function(e,t){var i=$(t).data("file-id");s(t,$("#"+i).find(".blob-code.blob-code-addition"))}),$("body").prepend('<span id="reviewed"></span>')}},HierarchyGeneratorService.prototype.generateAndApplyHierarchyHtml=function(e,t,i){this.files=e,this.fileIDs=t,this.element=i;var r=this.getCompressedHierarchy();this.generateAndApplyHtml(this.element,r,t)},HierarchyGeneratorService.prototype.getCompressedHierarchy=function(){var e=this.getHierarchyStructure(this.files);return this.compressHierarchy(e)},HierarchyGeneratorService.prototype.getHierarchyStructure=function(e){var t={};for(key in e){var i=e[key].split("/");this.addProp(t,i)}return t},HierarchyGeneratorService.prototype.addProp=function(e,t){if(1==t.length){var i=t.splice(0,1);return void(e[i[0]]=i[0])}if(t.length>1){var r=t.splice(0,1);e.hasOwnProperty(r)||(e[r]={}),this.addProp(e[r],t)}},HierarchyGeneratorService.prototype.compressHierarchy=function(e){function t(e,i,r){for(var n in e)r&&"string"==typeof e[n]||(r=r+String(n)+"/"),"string"!=typeof e[n]?"object"==typeof e[n]&&Object.keys(e[n]).length>1?(i[r]={},t(e[n],i[r],""),r=""):(t(e[n],i,r),r=""):(1==Object.keys(e).length?(i[r]={},i[r][String(n)+"/"]=e[n]):i[r]=e[n],r="")}var i={};return t(e,i,""),i},HierarchyGeneratorService.prototype.generateAndApplyHtml=function(e,t,i){var r=$(document.createElement("ul")),n=this;$.each(t,function(o,a){var s="string"==typeof a?a:o,c=$("<li>"+s+"</li>");"object"==typeof t[o]?c.addClass("folder"):"string"==typeof t[o]&&(c=$('<li><span class="file-name">'+s+"</span></li>"),c.addClass("jk-file"),c.attr("data-file-id",i[n.cnt]),n.cnt=n.cnt+1),r.append(c),e.append(r),"object"==typeof t[o]&&n.generateAndApplyHtml(r,t[o],i)})},HotKeysService.prototype.getKeyCodeForNextDiff=function(){return this.diffNext},HotKeysService.prototype.getKeyCodeForPrevDiff=function(){return this.diffPrev},HotKeysService.prototype.getKeyCodeForToggleSidebar=function(){return this.toggleSidebar},HotKeysService.prototype.getKeyCodeForCloseSidebar=function(){return this.closeSidebar},HotKeysService.prototype.isValidKeyCodeForDiff=function(e){return e==this.getKeyCodeForNextDiff()||e==this.getKeyCodeForPrevDiff()},HotKeysService.prototype.isValidKeyCodeForSideBarToggle=function(e){return e==this.getKeyCodeForToggleSidebar()},HotKeysService.prototype.isValidKeyCodeForCloseSidebar=function(e){return e==this.getKeyCodeForCloseSidebar()},HotKeysService.prototype.isValidKeyCode=function(e){return this.isValidKeyCodeForDiff(e)||this.isValidKeyCodeForCloseSidebar(e)||this.isValidKeyCodeForSideBarToggle(e)};