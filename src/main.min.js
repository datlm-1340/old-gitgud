function Main(){}function AppInteractionService(e,t,i){this.toolBarHeight=e,this.currentFileId=null,this.currentCommentId=null,this.files=this.getFiles(),this.hotKeysService=t,this.main=i}function DecorationService(e){this.element=e}function HierarchyGeneratorService(){this.cnt=0}function HotKeysService(){this.diffNext=190,this.diffPrev=188,this.toggleSidebar=77}Main.prototype.init=function(){this.hiddenSidebarUrls=[],this.pageLoadWaitTimeout=1e3,this.initialNumberOfFiles=0,this.hotKeysService=new HotKeysService,this.generateApp(),window==top&&(window.addEventListener("keyup",this.doKeyPress.bind(this),!1),setInterval(this.monitorUrlChange.bind(this),100)),setInterval(this.monitorLazyLoading.bind(this),100)},Main.prototype.generateApp=function(){this.currentPageUrl=this.getWindowLocationHref(),this.toolBarHeight=$(".pr-toolbar").height(),this.initialNumberOfFiles=$(".file").length;var e=[];$.each($(".file"),function(t,i){var n=$(i).find(".file-header[data-path]").data("path");n&&(e[t]=n)});var t=$('<p id="jk-hierarchy"></p>');(new HierarchyGeneratorService).generateAndApplyHierarchyHtml(e,t),$("body").prepend(t);var i=new DecorationService(t);i.applyInitStyle(),i.reviewDiffs(),i.appendShowMore(),i.appendCommentCounts(),i.appendNoDiffMessage();var n=new AppInteractionService(this.toolBarHeight,this.hotKeysService,this);n.attachFolderCollapseBehavior(t),n.attachJumpOnClickBehavior(t),n.updateCurentDiffPos(),this.appInteractionService=n},Main.prototype.doKeyPress=function(e){var t=$(e.target).prop("tagName");"BODY"!=t&&void 0!=t||this.hotKeysService.isValidKeyCode(e.keyCode)&&this.appInteractionService.respondToHotKey(e.keyCode)},Main.prototype.monitorUrlChange=function(){this.isSameUrl()||(this.currentPageUrl=this.getWindowLocationHref(),$("#jk-hierarchy").remove())},Main.prototype.isSameUrl=function(){return this.currentPageUrl==this.getWindowLocationHref()},Main.prototype.getWindowLocationHref=function(){return window.location.href.split("#")[0]},Main.prototype.monitorLazyLoading=function(){this.initialNumberOfFiles!=$(".file").length&&($("#jk-hierarchy").remove(),this.generateApp())},$(document).ready(function(){$("body").on("click",".load-diff-button",function(){var e=$('<p id="jk-hierarchy"></p>'),t=new DecorationService(e),i=$(this).closest("div.file").attr("id");t.reviewDiffs(i)})}),AppInteractionService.prototype.attachFolderCollapseBehavior=function(e){$(e).find(".folder").click(function(){$header=$(this),$content=$header.next(),$content.slideToggle(10,function(){$header.toggleClass("collapsed")})})},AppInteractionService.prototype.attachJumpOnClickBehavior=function(e){var t=this;$(e).find(".jk-file").click(function(){t.scrollTo($("#"+$(this).data("file-id"))),t.currentFileId=$(this).data("file-id").split("-")[1]})},AppInteractionService.prototype.scrollTo=function(e){if($(e).length){var t=$(e).offset().top-this.toolBarHeight-10;$("html,body").scrollTop(t),this.updateCurentDiffPos()}},AppInteractionService.prototype.updateCurentDiffPos=function(){var e=null;if($.each(this.getFiles(),function(t,i){i.getBoundingClientRect().top<139&&(e=$(i).attr("id"))}),$("#jk-hierarchy").find(".jk-file.current").removeClass("current"),$("#jk-hierarchy").find('.jk-file*[data-file-id="'+e+'"]').addClass("current"),$("#jk-hierarchy").is(":visible")&&$("#jk-hierarchy").find(".jk-file.current").is(":visible")){for(;function(){var e=$("#jk-hierarchy").find(".jk-file.current").position();return e&&e.top<0}();)$("#jk-hierarchy").scrollTop($("#jk-hierarchy").scrollTop()-10);for(;function(){var e=$("#jk-hierarchy").find(".jk-file.current").position();return e&&e.top>$("#jk-hierarchy").height()}();)$("#jk-hierarchy").scrollTop($("#jk-hierarchy").scrollTop()+10)}},AppInteractionService.prototype.getFiles=function(){return $(".file")},AppInteractionService.prototype.getComments=function(){return $("#files .js-comment.unminimized-comment")},AppInteractionService.prototype.getCurrentEl=function(){return this.getFiles()[this.currentFileId]},AppInteractionService.prototype.updateCurrentPos=function(e){null==this.currentFileId?this.currentFileId=0:this.currentFileId<this.files.length-1&&e==this.hotKeysService.getKeyCodeForNextDiff()?this.currentFileId++:this.currentFileId>0&&e==this.hotKeysService.getKeyCodeForPrevDiff()&&this.currentFileId--},AppInteractionService.prototype.respondToHotKey=function(e){if(this.hotKeysService.isValidKeyCodeForDiff(e)){this.updateCurrentPos(e);var t=this.getCurrentEl();return void this.scrollTo(t)}this.hotKeysService.isValidKeyCodeForSideBarToggle(e)&&(this.isSidebarHaveContents()||($("#jk-hierarchy").remove(),this.main.generateApp()),this.isSidebarHaveContents()?$("#jk-hierarchy").toggle():$("#jk-notice").show().delay(600).fadeOut(600))},AppInteractionService.prototype.isSidebarHaveContents=function(){return $("#jk-hierarchy").length&&$("#jk-hierarchy")[0].innerHTML};var WARNING=0,DANGER=1,checklistKey="GITGUD_CHECKLIST";String.prototype.htmlSafe=function(){return this.valueOf().replace(/\</g,"&lt;").replace(/\>/g,"&gt;")},DecorationService.prototype.applyInitStyle=function(){$(this.element).css("width",1.2*$(this.element).width()),$(this.element).css("background-color",$("body").css("background-color")),$(this.element).hide()},DecorationService.prototype.appendCommentCounts=function(){var e=$("#jk-hierarchy").find(".jk-file");$.each(e,function(e,t){var i=$(t).data("file-id"),n=$("#"+i).find(".js-comment.unminimized-comment");if(n.length){var r=$('<span class="comment-count"><b class="icon-comment">'+n.length+"</b></span>");$(t).append(r)}})},DecorationService.prototype.appendShowMore=function(){var e=$("#jk-hierarchy").find(".jk-file");$.each(e,function(e,t){var i=$(t).data("file-id"),n=$("#"+i).find(".load-diff-button");if(n.length>0){var n=$('<span class="unopened-count" title="Large diffs"><b class="icon-unopened">...</b></span>');$(t).append(n)}})},DecorationService.prototype.appendNoDiffMessage=function(){$("#jk-notice").length||($("body").prepend('<div id="jk-notice">No diffs found</div>'),$("#jk-notice").css("background-color",$("body").css("background-color")))},DecorationService.prototype.reviewDiffs=function(e){function t(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}function i(e,t){if("true"!==$(t).data("is-viewed")&&e.warningCounts>0){var i=$('<span class="gitgud-tooltip warning-count"><b class="icon-warning">'+e.warningCounts+'</b><span class="gitgud-tooltip-content"></span></span>');$(t).append(i),$.each(e.warnings,function(e,t){var n=$("<p>- "+t+"</p>");$(i).find(".gitgud-tooltip-content").append(n)})}}function n(e,t){if("true"!==$(t).data("is-viewed")&&e.dangerCounts>0){var i=$('<span class="gitgud-tooltip danger-count"><b class="icon-danger">'+e.dangerCounts+'</b><span class="gitgud-tooltip-content"></span></span>');$(t).append(i),$.each(e.dangers,function(e,t){var n=$("<p>- "+t+"</p>");$(i).find(".gitgud-tooltip-content").append(n)})}}function r(e,t){if(e>0){var e=$('<span class="warning-count"><b class="icon-warning">'+e+"</b></span>");$(t).append(e),$(t).addClass("gitgud-warning")}}function o(e,t){if(e>0){var e=$('<span class="danger-count"><b class="icon-danger">'+e+"</b></span>");$(t).append(e),$(t).addClass("gitgud-danger")}}function a(e,t,r){i(e,t),n(e,t),!0!==r&&$(t).data("is-viewed","true")}function c(e,i,n){chrome.storage.local.get(checklistKey,function(n){var c=0,s=0;PRChecklist=JSON.parse(n[checklistKey]),$.each(i,function(e,i){var n=$(i).find(".blob-code-inner.blob-code-marker").html(),r=t(n),o={warnings:[],dangers:[],warningCounts:0,dangerCounts:0};$.each(PRChecklist,function(e,t){r.includes(t.pattern)&&(t.type==WARNING?(o.warningCounts++,t.note.length&&o.warnings.push(t.note.htmlSafe())):(o.dangerCounts++,t.note.length&&o.dangers.push(t.note.htmlSafe())))}),a(o,i),c+=o.warningCounts,s+=o.dangerCounts}),r(c,e),o(s,e)})}if(e)var s=$("#"+e).find(".blob-code.blob-code-addition"),d=0,p=setInterval(function(){if(d++,console.log(d),s.length){var t=$("#jk-hierarchy ").find("[data-file-id="+e+"]");$(t).find(".unopened-count").hide(),c(t,s,!0),console.log("yey"),clearInterval(p)}else s=$("#"+e).find(".blob-code.blob-code-addition")},1e3);else{var l=$("#jk-hierarchy").find(".jk-file");$.each(l,function(e,t){var i=$(t).data("file-id");c(t,$("#"+i).find(".blob-code.blob-code-addition"))}),$("body").prepend('<span id="reviewed"></span>')}},HierarchyGeneratorService.prototype.generateAndApplyHierarchyHtml=function(e,t){this.files=e,this.element=t;var i=this.getCompressedHierarchy();this.generateAndApplyHtml(this.element,i)},HierarchyGeneratorService.prototype.getCompressedHierarchy=function(){var e=this.getHierarchyStructure(this.files);return this.compressHierarchy(e)},HierarchyGeneratorService.prototype.getHierarchyStructure=function(e){var t={};for(key in e){var i=e[key].split("/");this.addProp(t,i)}return t},HierarchyGeneratorService.prototype.addProp=function(e,t){if(1==t.length){var i=t.splice(0,1);return void(e[i[0]]=i[0])}if(t.length>1){var n=t.splice(0,1);e.hasOwnProperty(n)||(e[n]={}),this.addProp(e[n],t)}},HierarchyGeneratorService.prototype.compressHierarchy=function(e){function t(e,i,n){for(var r in e)n&&"string"==typeof e[r]||(n=n+String(r)+"/"),"string"!=typeof e[r]?"object"==typeof e[r]&&Object.keys(e[r]).length>1?(i[n]={},t(e[r],i[n],""),n=""):(t(e[r],i,n),n=""):(1==Object.keys(e).length?(i[n]={},i[n][String(r)+"/"]=e[r]):i[n]=e[r],n="")}var i={};return t(e,i,""),i},HierarchyGeneratorService.prototype.generateAndApplyHtml=function(e,t){var i=$(document.createElement("ul")),n=this;$.each(t,function(r,o){var a="string"==typeof o?o:r,c=$("<li>"+a+"</li>");"object"==typeof t[r]?c.addClass("folder"):"string"==typeof t[r]&&(c=$('<li><span class="file-name">'+a+"</span></li>"),c.addClass("jk-file"),c.attr("data-file-id","diff-"+n.cnt),n.cnt=n.cnt+1),i.append(c),e.append(i),"object"==typeof t[r]&&n.generateAndApplyHtml(i,t[r])})},HotKeysService.prototype.getKeyCodeForNextDiff=function(){return this.diffNext},HotKeysService.prototype.getKeyCodeForPrevDiff=function(){return this.diffPrev},HotKeysService.prototype.getKeyCodeForToggleSidebar=function(){return this.toggleSidebar},HotKeysService.prototype.isValidKeyCodeForDiff=function(e){return e==this.getKeyCodeForNextDiff()||e==this.getKeyCodeForPrevDiff()},HotKeysService.prototype.isValidKeyCodeForSideBarToggle=function(e){return e==this.getKeyCodeForToggleSidebar()},HotKeysService.prototype.isValidKeyCode=function(e){return this.isValidKeyCodeForDiff(e)||this.getKeyCodeForToggleSidebar(e)};